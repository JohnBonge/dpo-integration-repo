#!/usr/bin/env tsx

/**
 * Test IremboPay Configuration Script
 *
 * This script tests your IremboPay setup with the auto-generated product code
 *
 * Run with: npx tsx scripts/test-irembopay-config.ts
 */

console.log('ğŸ§ª Testing IremboPay Configuration...\n');

// Check environment variables
const requiredEnvVars = {
  IREMBO_SECRET_KEY: process.env.IREMBO_SECRET_KEY,
  IREMBO_PAYMENT_ACCOUNT_ID: process.env.IREMBO_PAYMENT_ACCOUNT_ID,
  NEXT_PUBLIC_APP_URL: process.env.NEXT_PUBLIC_APP_URL,
};

console.log('ğŸ“‹ Environment Variables Check:');
console.log('='.repeat(50));

let allConfigured = true;

Object.entries(requiredEnvVars).forEach(([key, value]) => {
  const status = value ? 'âœ…' : 'âŒ';
  const displayValue = value
    ? key.includes('SECRET')
      ? '[CONFIGURED]'
      : value
    : '[NOT SET]';

  console.log(`${status} ${key}: ${displayValue}`);

  if (!value) allConfigured = false;
});

console.log('\nğŸ¯ Configuration Status:');

if (allConfigured) {
  console.log('âœ… All required environment variables are configured!');

  console.log('\nğŸ“ Your Setup:');
  console.log(
    `   Payment Account: ${
      process.env.IREMBO_PAYMENT_ACCOUNT_ID || 'PI-bd12658823 (default)'
    }`
  );
  console.log(`   App URL: ${process.env.NEXT_PUBLIC_APP_URL}`);
  console.log(`   Currency: USD (based on IremboPay dashboard)`);

  console.log('\nğŸš€ Next Steps:');
  console.log(
    '1. Complete the product mappings in lib/services/irembopay-product-mapping.ts'
  );
  console.log('2. Run: npx tsx scripts/complete-irembopay-mappings.ts');
  console.log('3. Try making a test booking');
  console.log('4. Check the console logs for payment initialization');
} else {
  console.log('âŒ Some environment variables are missing.');

  console.log('\nğŸ”§ To Fix:');
  console.log('Add these to your .env file:');

  if (!process.env.IREMBO_SECRET_KEY) {
    console.log('   IREMBO_SECRET_KEY=your_secret_key_here');
  }

  if (!process.env.IREMBO_PAYMENT_ACCOUNT_ID) {
    console.log(
      '   IREMBO_PAYMENT_ACCOUNT_ID=PI-bd12658823  # Your payment account'
    );
  }

  if (!process.env.NEXT_PUBLIC_APP_URL) {
    console.log('   NEXT_PUBLIC_APP_URL=http://localhost:3000');
  }
}

console.log('\nğŸ’¡ How the Product Mapping System Works:');
console.log('   â†’ Each tour package ID is mapped to an IremboPay product code');
console.log(
  '   â†’ Product codes are auto-generated by IremboPay (e.g., PC-74ac3ffe8a)'
);
console.log('   â†’ Currency is USD as configured in your IremboPay dashboard');
console.log('   â†’ Prices are taken from the tour package data');

console.log('\nğŸ“‹ Current Mapping Status:');
console.log('   âœ… Kigali City Tour â†’ PC-74ac3ffe8a');
console.log('   âœ… Akagera National Park Safari â†’ PC-a12f760427');
console.log(
  '   âŒ 6 more tours need mapping (run complete-irembopay-mappings.ts)'
);

console.log('\nğŸ“ Need Help?');
console.log(
  '   â†’ Check IremboPay dashboard for correct payment account (must support USD)'
);
console.log('   â†’ Complete product mappings using the mapping script');
console.log(
  '   â†’ Test with mapped tours first (Kigali City Tour or Akagera Safari)'
);
